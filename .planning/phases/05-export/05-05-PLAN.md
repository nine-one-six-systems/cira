---
phase: 05-export
plan: 05
type: execute
wave: 2
depends_on:
  - 05-01
  - 05-02
  - 05-03
  - 05-04
files_modified:
  - .planning/phases/05-export/05-VERIFICATION.md
autonomous: false

must_haves:
  truths:
    - "All Phase 5 requirements (EXP-01 to EXP-05, API-08, UI-06) have passing tests"
    - "Test coverage demonstrates requirement satisfaction"
    - "Verification document maps requirements to test evidence"
  artifacts:
    - path: ".planning/phases/05-export/05-VERIFICATION.md"
      provides: "Requirement verification matrix with test evidence"
      min_lines: 150
  key_links:
    - from: "Requirement"
      to: "Test file"
      via: "verification mapping"
      pattern: "EXP-|API-|UI-"
---

<objective>
Run all Phase 5 tests and create verification documentation mapping requirements to test evidence.

Purpose: Provide traceable evidence that all Phase 5 requirements are satisfied by the implementation.

Output: Verification document with requirement-to-test mapping and pass/fail status.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/05-export/05-RESEARCH.md
@backend/tests/test_export_integration.py
@backend/tests/test_export_api_integration.py
@backend/tests/test_export_edge_cases.py
@frontend/src/__tests__/ExportUI.test.tsx
@backend/tests/test_export_service.py
@backend/tests/test_export_api.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Run all Phase 5 tests and collect results</name>
  <files>backend/tests/, frontend/src/__tests__/</files>
  <action>
Run all tests created in Plans 01-04 plus existing export tests and collect results:

1. Run backend export integration tests (Plan 01):
```bash
cd /Users/stephenhollifield/Cira && python3 -m pytest backend/tests/test_export_integration.py -v --tb=short 2>&1
```

2. Run backend export API integration tests (Plan 02):
```bash
cd /Users/stephenhollifield/Cira && python3 -m pytest backend/tests/test_export_api_integration.py -v --tb=short 2>&1
```

3. Run backend export edge case tests (Plan 03):
```bash
cd /Users/stephenhollifield/Cira && python3 -m pytest backend/tests/test_export_edge_cases.py -v --tb=short 2>&1
```

4. Run existing export unit tests to ensure no regressions:
```bash
cd /Users/stephenhollifield/Cira && python3 -m pytest backend/tests/test_export_service.py backend/tests/test_export_api.py -v --tb=short 2>&1
```

5. Run frontend export UI tests (Plan 04):
```bash
cd /Users/stephenhollifield/Cira/frontend && npm test -- --run src/__tests__/ExportUI.test.tsx 2>&1
```

6. Run full test suite to check for regressions:
```bash
cd /Users/stephenhollifield/Cira && python3 -m pytest backend/tests/ -v --tb=line -q 2>&1 | tail -20
```

Capture pass/fail counts and any failures for documentation.
  </action>
  <verify>
```bash
cd /Users/stephenhollifield/Cira && python3 -m pytest backend/tests/test_export_integration.py backend/tests/test_export_api_integration.py backend/tests/test_export_edge_cases.py backend/tests/test_export_service.py backend/tests/test_export_api.py --tb=line -q 2>&1 | tail -10
```
  </verify>
  <done>Test results collected for all Phase 5 test suites.</done>
</task>

<task type="auto">
  <name>Task 2: Create verification document</name>
  <files>.planning/phases/05-export/05-VERIFICATION.md</files>
  <action>
Create verification document at `.planning/phases/05-export/05-VERIFICATION.md`:

```markdown
# Phase 5: Export - Verification Report

**Verified:** [DATE]
**Status:** [PASS/FAIL]

## Summary

| Category | Tests | Passed | Failed |
|----------|-------|--------|--------|
| Export Integration (05-01) | X | X | 0 |
| Export API Integration (05-02) | X | X | 0 |
| Export Edge Cases (05-03) | X | X | 0 |
| Export UI (05-04) | X | X | 0 |
| Unit Tests (ExportService) | 36 | 36 | 0 |
| Unit Tests (ExportAPI) | 28 | 28 | 0 |
| **Total** | **X** | **X** | **0** |

## Requirement Verification Matrix

### Export Format Requirements

| Req ID | Requirement | Test File | Test Name | Status |
|--------|-------------|-----------|-----------|--------|
| EXP-01 | Markdown export (.md) | test_export_integration.py, test_export_service.py | test_markdown_includes_all_analysis_sections, TestMarkdownExport | PASS |
| EXP-02 | Word export (.docx) | test_export_integration.py, test_export_service.py | test_word_includes_all_analysis_sections, TestWordExport | PASS |
| EXP-03 | PDF export | test_export_integration.py, test_export_service.py | test_pdf_includes_all_analysis_sections, TestPdfExport | PASS |
| EXP-04 | JSON export with structured data | test_export_integration.py, test_export_service.py | test_json_includes_all_structured_data, TestJsonExport | PASS |
| EXP-05 | 2-page summary template structure | test_export_integration.py, test_export_edge_cases.py | test_markdown_includes_all_analysis_sections, TestExportMissingAnalysis | PASS |

### API Requirements

| Req ID | Requirement | Test File | Test Name | Status |
|--------|-------------|-----------|-----------|--------|
| API-08 | GET /export endpoint | test_export_api_integration.py, test_export_api.py | TestExportFormatResponses, TestExportEndpointValidation | PASS |

### UI Requirements

| Req ID | Requirement | Test File | Test Name | Status |
|--------|-------------|-----------|-----------|--------|
| UI-06 | Export dropdown menu | ExportUI.test.tsx | TestExportDropdownDisplay, TestExportSelection, TestExportSuccessFeedback | PASS |

## Test Evidence

### Export Integration Tests (05-01)
[Output from test run]

### Export API Integration Tests (05-02)
[Output from test run]

### Export Edge Case Tests (05-03)
[Output from test run]

### Export UI Tests (05-04)
[Output from test run]

### Unit Tests
[Output from test run]

## Implementation Coverage

### ExportService (export_service.py)
- Markdown generation with GFM tables: IMPLEMENTED
- Word generation with python-docx: IMPLEMENTED
- PDF generation with ReportLab: IMPLEMENTED
- JSON generation with structured data: IMPLEMENTED
- Token statistics calculation: IMPLEMENTED
- Key executives extraction: IMPLEMENTED
- Source URL listing: IMPLEMENTED
- 2-page template structure: IMPLEMENTED

### Export API (export.py)
- GET /export endpoint: IMPLEMENTED
- Format parameter validation: IMPLEMENTED
- Version parameter handling: IMPLEMENTED
- includeRawData parameter (JSON): IMPLEMENTED
- Content-Type headers per format: IMPLEMENTED
- Content-Disposition with filename: IMPLEMENTED
- Security headers: IMPLEMENTED
- Status validation (COMPLETED only): IMPLEMENTED

### Export UI (CompanyResults.tsx)
- Export dropdown with format options: IMPLEMENTED
- Format selection triggers download: IMPLEMENTED
- Loading state during export: IMPLEMENTED
- Success toast notification: IMPLEMENTED
- Error toast notification: IMPLEMENTED
- Blob download trigger: IMPLEMENTED

## Gaps Identified

[List any failing tests or uncovered requirements]

## Pre-existing Test Coverage

Phase 5 had extensive pre-existing test coverage:
- test_export_service.py: 36 tests covering ExportService class
- test_export_api.py: 28 tests covering API endpoint

Plans 01-04 added integration tests to verify component wiring and edge cases.

## Recommendations

[Any recommendations for Phase 6 based on verification results]
```

Fill in actual test results from Task 1.
  </action>
  <verify>
```bash
test -f /Users/stephenhollifield/Cira/.planning/phases/05-export/05-VERIFICATION.md && echo "Verification document exists" || echo "Missing"
```
  </verify>
  <done>Verification document created with complete requirement-to-test mapping.</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Complete Phase 5 test suite and verification documentation covering all requirements:
- EXP-01 to EXP-05 (Export formats and template)
- API-08 (Export API endpoint)
- UI-06 (Export dropdown UI)
  </what-built>
  <how-to-verify>
1. Review `.planning/phases/05-export/05-VERIFICATION.md`
2. Check that all 7 requirements have associated tests
3. Check that all tests are passing (Status = PASS)
4. Optionally run backend tests:
   ```bash
   cd /Users/stephenhollifield/Cira && python3 -m pytest backend/tests/test_export_integration.py backend/tests/test_export_api_integration.py backend/tests/test_export_edge_cases.py -v --tb=short | tail -50
   ```
5. Optionally run frontend tests:
   ```bash
   cd /Users/stephenhollifield/Cira/frontend && npm test -- --run src/__tests__/ExportUI.test.tsx
   ```
6. Optionally test export manually:
   - Navigate to a completed company
   - Try each export format (Markdown, PDF, Word, JSON)
   - Verify files download correctly
  </how-to-verify>
  <resume-signal>Type "verified" to confirm Phase 5 is complete, or describe any gaps found.</resume-signal>
</task>

</tasks>

<verification>
Phase 5 is verified when:
1. All test suites pass
2. Verification document maps all requirements to tests
3. Human has confirmed the verification report

```bash
# Quick verification
cd /Users/stephenhollifield/Cira && python3 -m pytest backend/tests/test_export_integration.py backend/tests/test_export_api_integration.py backend/tests/test_export_edge_cases.py backend/tests/test_export_service.py backend/tests/test_export_api.py -v --tb=line 2>&1 | tail -20
```
</verification>

<success_criteria>
- [ ] All Phase 5 tests pass (new integration + existing unit tests)
- [ ] Verification document created
- [ ] All 7 requirements (EXP-01-05, API-08, UI-06) mapped to tests
- [ ] Human verification checkpoint approved
</success_criteria>

<output>
After completion, create `.planning/phases/05-export/05-05-SUMMARY.md`
</output>
