---
phase: 02-entity-extraction
plan: 04
type: execute
wave: 1
depends_on: []
files_modified:
  - frontend/src/__tests__/EntitiesTab.test.tsx
autonomous: true

must_haves:
  truths:
    - "Entity table displays entity type, value, confidence, and source"
    - "Type filter dropdown filters entities by selected type"
    - "Confidence displayed as colored progress bar"
    - "Pagination controls navigate between pages"
    - "Loading state shows skeleton while fetching"
  artifacts:
    - path: "frontend/src/__tests__/EntitiesTab.test.tsx"
      provides: "Component tests for entity browser UI"
      min_lines: 150
  key_links:
    - from: "CompanyResults"
      to: "useEntities"
      via: "React Query hook"
      pattern: "useEntities"
    - from: "EntitiesContent"
      to: "Select component"
      via: "type filter dropdown"
      pattern: "ENTITY_TYPE_OPTIONS"
---

<objective>
Create frontend component tests for the entity browser (Entities tab in CompanyResults).

Purpose: Verify that UI-05 (entity browser with filtering) works correctly by testing user interactions with the entity table, type filter, and pagination.

Output: React Testing Library tests covering entity display, filtering, and pagination.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/02-entity-extraction/02-RESEARCH.md
@frontend/src/pages/CompanyResults.tsx
@frontend/src/hooks/useCompanies.ts
@frontend/src/__tests__/AddCompany.test.tsx
@frontend/src/__tests__/Dashboard.test.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create entity browser component tests</name>
  <files>frontend/src/__tests__/EntitiesTab.test.tsx</files>
  <action>
Create component tests at `frontend/src/__tests__/EntitiesTab.test.tsx`:

1. **Setup and Mocks**
   - Import React Testing Library utilities (render, screen, fireEvent, waitFor)
   - Import vi from vitest for mocking
   - Mock useCompanies hooks (useCompany, useEntities, usePages, useTokens, useVersions)
   - Mock react-router-dom (useParams returns test company ID)
   - Create mock entity data with various types and confidences
   - Create mock company data

2. **Test class/describe: Entity Table Display**

   - `renders entity table with columns`:
     - Mock useEntities to return 3 entities
     - Render CompanyResults, click Entities tab
     - Assert table headers visible: Type, Value, Confidence, Source
     - Assert 3 rows in table

   - `displays entity type as badge`:
     - Mock entity with type 'person'
     - Assert Badge component shows 'Person' text

   - `displays entity value with context snippet`:
     - Mock entity with entityValue='John Smith' and contextSnippet='CEO John Smith leads'
     - Assert 'John Smith' visible in row
     - Assert context snippet visible (truncated if needed)

   - `displays confidence as colored progress bar`:
     - Mock entities with confidence 0.9, 0.7, 0.4
     - Assert progress bars rendered
     - Assert high confidence (>=0.8) has green/success color class
     - Assert medium confidence (0.6-0.8) has yellow/warning color class
     - Assert low confidence (<0.6) has red/error color class

   - `displays source URL as clickable link`:
     - Mock entity with sourceUrl='https://example.com/about'
     - Assert link rendered with href
     - Assert target='_blank' for external link

3. **Test class/describe: Type Filter**

   - `type filter dropdown shows all options`:
     - Render component
     - Click/open type filter dropdown
     - Assert 'All Types' option visible
     - Assert entity type options visible (Person, Organization, Location, Email, etc.)

   - `selecting type filter updates displayed entities`:
     - Mock useEntities to track query params
     - Select 'Person' from type filter
     - Assert useEntities called with type='person'

   - `filter resets to page 1 when changed`:
     - Navigate to page 2
     - Change type filter
     - Assert page reset to 1

4. **Test class/describe: Pagination**

   - `shows pagination when more than one page`:
     - Mock useEntities to return meta.totalPages=3
     - Assert 'Page 1 of 3' text visible
     - Assert Previous and Next buttons visible

   - `hides pagination when only one page`:
     - Mock useEntities to return meta.totalPages=1
     - Assert pagination controls not visible

   - `Previous button disabled on page 1`:
     - On page 1
     - Assert Previous button disabled

   - `Next button disabled on last page`:
     - On page 3 of 3
     - Assert Next button disabled

   - `clicking Next increments page`:
     - Mock setEntityPage tracking
     - Click Next button
     - Assert page incremented

   - `clicking Previous decrements page`:
     - Start on page 2
     - Click Previous button
     - Assert page decremented

5. **Test class/describe: Loading and Empty States**

   - `shows skeleton while loading entities`:
     - Mock useEntities with isLoading=true
     - Assert Skeleton component visible
     - Assert table not visible

   - `shows empty message when no entities`:
     - Mock useEntities to return empty data array
     - Assert 'No entities found' message visible

   - `shows entity count`:
     - Mock useEntities to return meta.total=42
     - Assert '42 entities found' text visible

6. **Test class/describe: Entity Count in Tab**

   - `tab shows entity count`:
     - Mock useCompany to return entityCount=15
     - Assert tab label shows 'Entities (15)'

7. Use vitest patterns consistent with existing tests (AddCompany.test.tsx, Dashboard.test.tsx).

8. Mock hooks using vi.mock() and vi.fn() patterns.

9. Use userEvent for interactions where appropriate.
  </action>
  <verify>
```bash
cd /Users/stephenhollifield/Cira/frontend && npm test -- --run src/__tests__/EntitiesTab.test.tsx 2>&1 | head -60
```
  </verify>
  <done>All frontend tests pass, verifying UI-05 (entity browser with filtering) works correctly.</done>
</task>

</tasks>

<verification>
Run frontend tests to verify entity browser UI:

```bash
cd /Users/stephenhollifield/Cira/frontend && npm test -- --run
```

Expected: All tests pass, demonstrating UI-05 requirement is satisfied.
</verification>

<success_criteria>
- [ ] Entity table displays all required columns
- [ ] Type filter dropdown works correctly
- [ ] Confidence shown as colored progress bar
- [ ] Pagination controls function properly
- [ ] Loading skeleton displays during fetch
- [ ] Empty state handled gracefully
</success_criteria>

<output>
After completion, create `.planning/phases/02-entity-extraction/02-04-SUMMARY.md`
</output>
