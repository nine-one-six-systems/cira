---
phase: 06-batch-processing
plan: 04
type: execute
wave: 1
depends_on: []
files_modified:
  - frontend/src/__tests__/BatchUploadUI.test.tsx
  - frontend/src/__tests__/ConfigPanel.test.tsx
  - frontend/src/__tests__/DeleteModal.test.tsx
autonomous: true

must_haves:
  truths:
    - "Batch upload UI allows file selection and shows preview"
    - "Validation errors are highlighted in preview table"
    - "Template download button triggers file download"
    - "Configuration panel allows Quick/Thorough mode selection"
    - "Delete confirmation modal requires explicit confirmation"
  artifacts:
    - path: "frontend/src/__tests__/BatchUploadUI.test.tsx"
      provides: "React Testing Library tests for BatchUpload page"
      min_lines: 150
    - path: "frontend/src/__tests__/ConfigPanel.test.tsx"
      provides: "Tests for configuration panel component"
      min_lines: 80
    - path: "frontend/src/__tests__/DeleteModal.test.tsx"
      provides: "Tests for delete confirmation modal"
      min_lines: 60
  key_links:
    - from: "BatchUpload.tsx"
      to: "useBatchUpload hook"
      via: "useCompanies import"
      pattern: "useBatchUpload"
    - from: "Settings.tsx"
      to: "Configuration state"
      via: "useState for config"
      pattern: "useState.*config"
    - from: "Delete modal"
      to: "useDeleteCompany hook"
      via: "mutation trigger"
      pattern: "useDeleteCompany|deleteCompany"
---

<objective>
Create React Testing Library tests for batch upload UI, configuration panel, and delete confirmation modal.

Purpose: Validate that frontend components correctly handle batch upload flow, configuration options, and delete confirmation UX.

Output: Frontend test files covering UI-08, UI-09, and UI-10 requirements.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/06-batch-processing/06-RESEARCH.md
@frontend/src/pages/BatchUpload.tsx
@frontend/src/pages/Settings.tsx
@frontend/src/pages/Dashboard.tsx
@frontend/src/hooks/useCompanies.ts
@frontend/src/__tests__/Dashboard.test.tsx
@frontend/src/__tests__/AddCompany.test.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create BatchUpload component tests</name>
  <files>frontend/src/__tests__/BatchUploadUI.test.tsx</files>
  <action>
Create React Testing Library tests for BatchUpload at `frontend/src/__tests__/BatchUploadUI.test.tsx`:

1. **Import setup**:
   - Import render, screen, fireEvent, waitFor from @testing-library/react
   - Import userEvent from @testing-library/user-event
   - Import vi from vitest
   - Import BatchUpload component (or router wrapper if needed)
   - Mock useCompanies hooks (useBatchUpload, useDownloadTemplate)

2. **Test class: TestBatchUploadDisplay (UI-09)**

   - `renders batch upload page with file drop zone`:
     - Render BatchUpload
     - Assert heading with "Batch Upload" or similar visible
     - Assert drop zone or file input present

   - `renders template download button`:
     - Render BatchUpload
     - Assert button with "Download Template" visible

   - `shows file input for CSV upload`:
     - Render BatchUpload
     - Assert input[type="file"] exists (may be hidden)
     - Assert accepts .csv files

3. **Test class: TestFileUpload (UI-09)**

   - `accepts valid CSV file`:
     - Create File object with valid CSV content
     - Trigger file input change event
     - Assert preview appears or file name displayed

   - `shows preview table after file selection`:
     - Upload CSV with 3 rows
     - Assert table or preview section appears
     - Assert company names from CSV visible

   - `highlights validation errors in preview`:
     - Upload CSV with invalid row (missing URL)
     - Assert error indicator (red text, icon) visible
     - Assert row marked as invalid

   - `shows valid/invalid row counts`:
     - Upload mixed CSV (2 valid, 1 invalid)
     - Assert text showing "2 valid" and "1 error" or similar

4. **Test class: TestTemplateDownload (BAT-03)**

   - `clicking template button triggers download`:
     - Mock useDownloadTemplate mutation
     - Click download template button
     - Assert mutation was called

   - `shows loading state during download`:
     - Mock useDownloadTemplate with isLoading=true
     - Assert loading indicator on button

5. **Test class: TestBatchSubmission (UI-09)**

   - `submit button disabled without file`:
     - Render BatchUpload with no file
     - Assert submit/upload button disabled

   - `submit button enabled with valid file`:
     - Upload valid CSV
     - Assert submit button enabled

   - `submit button disabled if all rows invalid`:
     - Upload all-invalid CSV
     - Assert submit button disabled

   - `successful upload shows success message`:
     - Mock useBatchUpload.mutate success
     - Upload and submit
     - Assert success toast or message

   - `failed upload shows error message`:
     - Mock useBatchUpload.mutate error
     - Upload and submit
     - Assert error message displayed

6. **Test class: TestNavigationAndAccessibility**

   - `can navigate back to dashboard`:
     - Render with router
     - Click back/cancel link
     - Assert navigation to dashboard

   - `supports keyboard navigation`:
     - Tab through focusable elements
     - Assert focus moves correctly

Mock pattern from existing tests (Dashboard.test.tsx, AddCompany.test.tsx):
```typescript
vi.mock('../hooks/useCompanies', () => ({
  useBatchUpload: vi.fn(() => ({
    mutate: vi.fn(),
    isLoading: false,
    isSuccess: false,
    isError: false,
  })),
  useDownloadTemplate: vi.fn(() => ({
    mutate: vi.fn(),
    isLoading: false,
  })),
}));
```
  </action>
  <verify>
```bash
cd /Users/stephenhollifield/Cira/frontend && npm test -- --run src/__tests__/BatchUploadUI.test.tsx 2>&1 | head -40
```
  </verify>
  <done>BatchUpload UI tests verify file upload, preview, and submission flow for UI-09.</done>
</task>

<task type="auto">
  <name>Task 2: Create Settings/Configuration panel tests</name>
  <files>frontend/src/__tests__/ConfigPanel.test.tsx</files>
  <action>
Create tests for Settings/Configuration panel at `frontend/src/__tests__/ConfigPanel.test.tsx`:

1. **Import setup**:
   - Import render, screen, fireEvent from @testing-library/react
   - Import userEvent from @testing-library/user-event
   - Import vi from vitest
   - Import Settings component or relevant config panel

2. **Test class: TestConfigurationDisplay (UI-08)**

   - `renders settings page with configuration options`:
     - Render Settings
     - Assert heading visible
     - Assert configuration form elements present

   - `displays Quick and Thorough mode options`:
     - Render Settings
     - Assert "Quick" option visible (button, radio, or preset)
     - Assert "Thorough" option visible

   - `shows max pages slider or input`:
     - Render Settings
     - Assert max pages control present
     - Assert default value reasonable (50 or similar)

   - `shows max depth control`:
     - Render Settings
     - Assert depth limit control present

3. **Test class: TestModePresets (UI-08)**

   - `Quick mode sets fast configuration`:
     - Click Quick mode
     - Assert max pages is lower value
     - Assert depth is limited

   - `Thorough mode sets comprehensive configuration`:
     - Click Thorough mode
     - Assert max pages is higher value
     - Assert depth allows more

   - `mode selection updates form values`:
     - Select Quick, verify values
     - Select Thorough, verify values changed

4. **Test class: TestConfigurationPersistence**

   - `save button is present`:
     - Render Settings
     - Assert save button visible

   - `save button triggers save action`:
     - Mock save mutation
     - Click save button
     - Assert mutation called

   - `shows success feedback on save`:
     - Mock successful save
     - Click save
     - Assert success message/toast

   - `reset button restores defaults`:
     - If reset button exists
     - Modify values, click reset
     - Assert values reset to defaults

5. **Test class: TestAccessibility**

   - `form controls have labels`:
     - Assert all inputs have associated labels
     - Assert labels are accessible

   - `keyboard navigation works`:
     - Tab through controls
     - Assert focus order makes sense

Mock any settings hooks:
```typescript
vi.mock('../hooks/useSettings', () => ({
  useSettings: vi.fn(() => ({
    settings: { maxPages: 50, maxDepth: 3, mode: 'quick' },
    updateSettings: vi.fn(),
    isLoading: false,
  })),
}));
```
  </action>
  <verify>
```bash
cd /Users/stephenhollifield/Cira/frontend && npm test -- --run src/__tests__/ConfigPanel.test.tsx 2>&1 | head -30
```
  </verify>
  <done>Configuration panel tests verify UI-08 mode presets and settings controls.</done>
</task>

<task type="auto">
  <name>Task 3: Create delete confirmation modal tests</name>
  <files>frontend/src/__tests__/DeleteModal.test.tsx</files>
  <action>
Create tests for delete confirmation modal at `frontend/src/__tests__/DeleteModal.test.tsx`:

1. **Import setup**:
   - Import render, screen, fireEvent from @testing-library/react
   - Import userEvent from @testing-library/user-event
   - Import vi from vitest
   - Import Dashboard or component containing delete modal

2. **Test class: TestDeleteModalDisplay (UI-10)**

   - `delete button is visible on company row`:
     - Render Dashboard with companies
     - Assert delete button/icon visible for each company

   - `clicking delete opens confirmation modal`:
     - Mock companies data
     - Click delete button on a company
     - Assert modal appears with confirmation text

   - `modal shows company name being deleted`:
     - Open delete modal for "Acme Corp"
     - Assert modal mentions "Acme Corp"

   - `modal has confirm and cancel buttons`:
     - Open delete modal
     - Assert "Delete" or "Confirm" button visible
     - Assert "Cancel" button visible

3. **Test class: TestDeleteConfirmation (UI-10)**

   - `cancel button closes modal`:
     - Open delete modal
     - Click Cancel
     - Assert modal closed

   - `confirm button triggers delete`:
     - Mock useDeleteCompany mutation
     - Open modal, click confirm
     - Assert mutation called with company ID

   - `shows loading state during delete`:
     - Mock mutation with isLoading=true
     - Assert loading indicator on confirm button

   - `closes modal on successful delete`:
     - Mock successful delete
     - Confirm deletion
     - Assert modal closes

   - `shows error on failed delete`:
     - Mock failed delete
     - Confirm deletion
     - Assert error message displayed

4. **Test class: TestDeleteAccessibility**

   - `modal traps focus`:
     - Open modal
     - Tab through elements
     - Assert focus stays in modal

   - `escape key closes modal`:
     - Open modal
     - Press Escape
     - Assert modal closes

   - `clicking outside closes modal`:
     - Open modal
     - Click modal backdrop
     - Assert modal closes (if this behavior exists)

Mock pattern:
```typescript
vi.mock('../hooks/useCompanies', () => ({
  useCompanies: vi.fn(() => ({
    data: [
      { id: '1', companyName: 'Acme Corp', status: 'completed' },
      { id: '2', companyName: 'Beta Inc', status: 'pending' },
    ],
    isLoading: false,
  })),
  useDeleteCompany: vi.fn(() => ({
    mutate: vi.fn(),
    isLoading: false,
  })),
}));
```
  </action>
  <verify>
```bash
cd /Users/stephenhollifield/Cira/frontend && npm test -- --run src/__tests__/DeleteModal.test.tsx 2>&1 | head -30
```
  </verify>
  <done>Delete modal tests verify UI-10 confirmation flow and accessibility.</done>
</task>

</tasks>

<verification>
Run all frontend batch UI tests:

```bash
cd /Users/stephenhollifield/Cira/frontend && npm test -- --run src/__tests__/BatchUploadUI.test.tsx src/__tests__/ConfigPanel.test.tsx src/__tests__/DeleteModal.test.tsx
```

Expected: All tests pass, verifying UI-08, UI-09, and UI-10 requirements.
</verification>

<success_criteria>
- [ ] BatchUpload tests cover file upload, preview, validation (UI-09)
- [ ] Template download tests verify BAT-03 UI trigger
- [ ] Configuration panel tests cover mode presets (UI-08)
- [ ] Delete modal tests cover confirmation flow (UI-10)
- [ ] All tests use React Testing Library patterns
- [ ] Tests follow existing project patterns
- [ ] All tests pass with existing implementation
- [ ] Tests documented with requirement traceability
</success_criteria>

<output>
After completion, create `.planning/phases/06-batch-processing/06-04-SUMMARY.md`
</output>
