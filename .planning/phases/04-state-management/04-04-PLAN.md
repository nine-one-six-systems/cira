---
phase: 04-state-management
plan: 04
type: execute
wave: 1
depends_on: []
files_modified:
  - frontend/src/__tests__/PauseResumeUI.test.tsx
autonomous: true

must_haves:
  truths:
    - "Pause button visible and clickable for in_progress companies"
    - "Resume button visible and clickable for paused companies"
    - "Progress bar shows correct percentage and phase"
    - "Status badge reflects current state (in_progress, paused, completed, failed)"
    - "Time elapsed and estimated remaining displayed correctly"
    - "Toast notifications shown for pause/resume actions"
  artifacts:
    - path: "frontend/src/__tests__/PauseResumeUI.test.tsx"
      provides: "Component tests for pause/resume UI and progress display"
      min_lines: 200
  key_links:
    - from: "CompanyProgress"
      to: "usePauseCompany"
      via: "handlePause()"
      pattern: "usePauseCompany|handlePause"
    - from: "CompanyProgress"
      to: "useResumeCompany"
      via: "handleResume()"
      pattern: "useResumeCompany|handleResume"
    - from: "CompanyProgress"
      to: "useProgress"
      via: "polling progress"
      pattern: "useProgress|shouldPoll"
---

<objective>
Create frontend component tests for the pause/resume UI functionality and progress display.

Purpose: Verify that UI-07 (pause/resume in UI) works correctly by testing user-visible components including buttons, status transitions, progress display, and notifications.

Output: React Testing Library tests covering pause/resume buttons, progress tracking, and status display.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/04-state-management/04-RESEARCH.md
@frontend/src/pages/CompanyProgress.tsx
@frontend/src/hooks/useCompanies.ts
@frontend/src/__tests__/AddCompany.test.tsx
@frontend/src/__tests__/Dashboard.test.tsx
@frontend/src/__tests__/AnalysisUI.test.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create pause/resume UI component tests</name>
  <files>frontend/src/__tests__/PauseResumeUI.test.tsx</files>
  <action>
Create component tests at `frontend/src/__tests__/PauseResumeUI.test.tsx`:

1. **Setup and Mocks**
   - Import React Testing Library utilities (render, screen, fireEvent, waitFor)
   - Import vi from vitest for mocking
   - Mock useCompanies hooks (useCompany, useProgress, usePauseCompany, useResumeCompany, useDeleteCompany)
   - Mock react-router-dom (useParams, useNavigate)
   - Mock useToast from components/ui
   - Create mock company data for each status (in_progress, paused, completed, failed)
   - Create mock progress data with pages, entities, tokens, time

2. **Test describe: Pause Button (UI-07)**

   - `renders pause button for in_progress company`:
     - Mock company with status='in_progress'
     - Render CompanyProgress
     - Assert 'Pause' button visible
     - Assert button is enabled

   - `pause button hidden for paused company`:
     - Mock company with status='paused'
     - Render CompanyProgress
     - Assert 'Pause' button not visible
     - Assert 'Resume' button visible instead

   - `pause button hidden for completed company`:
     - Mock company with status='completed'
     - Render CompanyProgress
     - Assert 'Pause' button not visible

   - `pause button hidden for failed company`:
     - Mock company with status='failed'
     - Render CompanyProgress
     - Assert 'Pause' button not visible

   - `clicking pause button calls mutation`:
     - Mock usePauseCompany with mutateAsync
     - Click 'Pause' button
     - Assert mutateAsync called with company ID

   - `pause button shows loading state`:
     - Mock usePauseCompany with isPending=true
     - Render CompanyProgress
     - Assert button shows loading indicator or is disabled

   - `pause success shows toast notification`:
     - Mock successful pause mutation
     - Click 'Pause' button
     - Wait for mutation to complete
     - Assert showToast called with success message

   - `pause error shows error toast`:
     - Mock pause mutation to reject
     - Click 'Pause' button
     - Wait for error
     - Assert showToast called with error message

3. **Test describe: Resume Button (UI-07)**

   - `renders resume button for paused company`:
     - Mock company with status='paused'
     - Render CompanyProgress
     - Assert 'Resume' button visible
     - Assert button is enabled

   - `resume button hidden for in_progress company`:
     - Mock company with status='in_progress'
     - Render CompanyProgress
     - Assert 'Resume' button not visible

   - `clicking resume button calls mutation`:
     - Mock useResumeCompany with mutateAsync
     - Click 'Resume' button
     - Assert mutateAsync called with company ID

   - `resume button shows loading state`:
     - Mock useResumeCompany with isPending=true
     - Render CompanyProgress
     - Assert button shows loading indicator

   - `resume success shows toast notification`:
     - Mock successful resume mutation
     - Click 'Resume' button
     - Assert showToast called with success message

   - `resume error shows error toast`:
     - Mock resume mutation to reject
     - Click 'Resume' button
     - Assert showToast called with error message

4. **Test describe: Progress Display**

   - `displays progress percentage`:
     - Mock useProgress with pagesCrawled=10, pagesTotal=20
     - Render CompanyProgress
     - Assert '50%' visible in UI

   - `displays current phase`:
     - Mock company with processing_phase='crawling'
     - Render CompanyProgress
     - Assert 'Crawling Website' or similar visible

   - `displays pages crawled count`:
     - Mock progress with pagesCrawled=15, pagesTotal=25
     - Render CompanyProgress
     - Assert '15' visible
     - Assert '/25' or 'of 25' visible

   - `displays entities extracted count`:
     - Mock progress with entitiesExtracted=42
     - Render CompanyProgress
     - Assert '42' visible in entities section

   - `displays tokens used count`:
     - Mock progress with tokensUsed=5000
     - Render CompanyProgress
     - Assert '5K' or '5,000' visible

   - `displays estimated cost`:
     - Mock company with estimatedCost=0.0042
     - Render CompanyProgress
     - Assert '$0.004' or similar visible

   - `displays time elapsed`:
     - Mock progress with timeElapsed=120
     - Render CompanyProgress
     - Assert '2m' or '2m 0s' visible

   - `displays estimated time remaining`:
     - Mock progress with estimatedTimeRemaining=180
     - Render CompanyProgress
     - Assert '~3m' or similar visible

   - `hides estimated time when paused`:
     - Mock company with status='paused'
     - Render CompanyProgress
     - Assert estimated time remaining not visible

5. **Test describe: Status Display**

   - `shows correct badge for in_progress`:
     - Mock company with status='in_progress'
     - Render CompanyProgress
     - Assert badge with 'in progress' text visible
     - Assert appropriate badge color (primary/blue)

   - `shows correct badge for paused`:
     - Mock company with status='paused'
     - Render CompanyProgress
     - Assert badge with 'paused' text visible
     - Assert appropriate badge color (warning/yellow)

   - `shows correct badge for completed`:
     - Mock company with status='completed'
     - Render CompanyProgress
     - Assert badge with 'completed' text visible
     - Assert appropriate badge color (success/green)

   - `shows correct badge for failed`:
     - Mock company with status='failed'
     - Render CompanyProgress
     - Assert badge with 'failed' text visible
     - Assert appropriate badge color (error/red)

   - `progress bar color matches status`:
     - in_progress -> primary color
     - paused -> warning color
     - failed -> error color

6. **Test describe: Current Activity**

   - `shows current activity text when in_progress`:
     - Mock progress with currentActivity='Crawling page 10 of 25...'
     - Render CompanyProgress
     - Assert activity text visible

   - `hides activity text when paused`:
     - Mock company with status='paused'
     - Render CompanyProgress
     - Assert activity text not visible (or shows paused message)

   - `shows paused message when paused`:
     - Mock company with status='paused'
     - Render CompanyProgress
     - Assert 'paused' or 'Click Resume to continue' visible

   - `shows failure message when failed`:
     - Mock company with status='failed'
     - Render CompanyProgress
     - Assert 'failed' or 'Please try again' visible

7. **Test describe: Auto-redirect on Completion**

   - `redirects to results when completed`:
     - Mock company with status='completed'
     - Mock useNavigate
     - Render CompanyProgress
     - Wait for timeout (2 seconds)
     - Assert navigate called with /companies/{id}

   - `shows completion message before redirect`:
     - Mock company with status='completed'
     - Render CompanyProgress
     - Assert 'Analysis Complete!' visible
     - Assert 'Redirecting to results' visible

8. **Test describe: Cancel Modal**

   - `cancel button opens confirmation modal`:
     - Mock in_progress company
     - Click 'Cancel' button
     - Assert modal visible
     - Assert 'Are you sure' text visible

   - `modal cancel button dismisses modal`:
     - Open cancel modal
     - Click 'Keep Analyzing' or similar
     - Assert modal closed

   - `modal confirm calls delete mutation`:
     - Open cancel modal
     - Click 'Cancel & Delete'
     - Assert useDeleteCompany.mutateAsync called

   - `successful cancel navigates to home`:
     - Complete cancel flow
     - Assert navigate called with '/'

9. **Test describe: Loading States**

   - `shows skeleton during company loading`:
     - Mock useCompany with isLoading=true
     - Render CompanyProgress
     - Assert Skeleton components visible

   - `shows skeleton during progress loading`:
     - Mock useProgress with isLoading=true
     - Render CompanyProgress
     - Assert loading indicators visible

10. **Test describe: Error States**

   - `shows error when company not found`:
     - Mock useCompany returning null/error
     - Render CompanyProgress
     - Assert 'Company Not Found' visible

11. Use vitest patterns consistent with existing tests (AnalysisUI.test.tsx).

12. Mock hooks using vi.mock() and vi.fn() patterns.

13. Use userEvent for button clicks where appropriate.
  </action>
  <verify>
```bash
cd /Users/stephenhollifield/Cira/frontend && npm test -- --run src/__tests__/PauseResumeUI.test.tsx 2>&1 | head -60
```
  </verify>
  <done>All frontend tests pass, verifying UI-07 (pause/resume in UI) works correctly.</done>
</task>

</tasks>

<verification>
Run frontend tests to verify pause/resume UI:

```bash
cd /Users/stephenhollifield/Cira/frontend && npm test -- --run
```

Expected: All tests pass, demonstrating UI-07 requirement is satisfied.
</verification>

<success_criteria>
- [ ] Pause button visible and functional for in_progress companies
- [ ] Resume button visible and functional for paused companies
- [ ] Progress percentage and phase displayed correctly
- [ ] Status badges reflect current state
- [ ] Time elapsed and estimated remaining displayed
- [ ] Toast notifications for pause/resume actions
- [ ] Loading states shown appropriately
- [ ] Cancel modal works correctly
</success_criteria>

<output>
After completion, create `.planning/phases/04-state-management/04-04-SUMMARY.md`
</output>
