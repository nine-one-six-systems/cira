---
phase: 01-web-crawling
plan: 05
type: execute
wave: 3
depends_on:
  - 01-01
  - 01-02
  - 01-03
  - 01-04
files_modified:
  - .planning/phases/01-web-crawling/01-VERIFICATION.md
autonomous: false

must_haves:
  truths:
    - "All Phase 1 requirements (CRL-01 to CRL-07, API-01/03/04, UI-01/02) have passing tests"
    - "Test coverage demonstrates requirement satisfaction"
    - "Verification document maps requirements to test evidence"
  artifacts:
    - path: ".planning/phases/01-web-crawling/01-VERIFICATION.md"
      provides: "Requirement verification matrix with test evidence"
      min_lines: 100
  key_links:
    - from: "Requirement"
      to: "Test file"
      via: "verification mapping"
      pattern: "CRL-|API-|UI-"
---

<objective>
Run all Phase 1 tests and create verification documentation mapping requirements to test evidence.

Purpose: Provide traceable evidence that all Phase 1 requirements are satisfied by the implementation.

Output: Verification document with requirement-to-test mapping and pass/fail status.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/01-web-crawling/01-RESEARCH.md
@backend/tests/test_crawl_integration.py
@backend/tests/test_api_crawl_integration.py
@backend/tests/test_crawl_edge_cases.py
@frontend/src/__tests__/AddCompany.test.tsx
@frontend/src/__tests__/Dashboard.test.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Run all Phase 1 tests and collect results</name>
  <files></files>
  <action>
Run all tests created in Plans 01-04 and collect results:

1. Run backend crawl integration tests:
```bash
cd /Users/stephenhollifield/Cira && python3 -m pytest backend/tests/test_crawl_integration.py -v --tb=short 2>&1
```

2. Run backend API integration tests:
```bash
cd /Users/stephenhollifield/Cira && python3 -m pytest backend/tests/test_api_crawl_integration.py -v --tb=short 2>&1
```

3. Run backend edge case tests:
```bash
cd /Users/stephenhollifield/Cira && python3 -m pytest backend/tests/test_crawl_edge_cases.py -v --tb=short 2>&1
```

4. Run existing crawler unit tests to ensure no regressions:
```bash
cd /Users/stephenhollifield/Cira && python3 -m pytest backend/tests/test_crawl_worker.py backend/tests/test_sitemap_parser.py backend/tests/test_robots_parser.py backend/tests/test_rate_limiter.py backend/tests/test_external_links.py -v --tb=short 2>&1
```

5. Run frontend component tests:
```bash
cd /Users/stephenhollifield/Cira/frontend && npm test -- --run 2>&1
```

Capture pass/fail counts and any failures for documentation.
  </action>
  <verify>
All test commands complete without errors. Record pass/fail counts.
  </verify>
  <done>Test results collected for all Phase 1 test suites.</done>
</task>

<task type="auto">
  <name>Task 2: Create verification document</name>
  <files>.planning/phases/01-web-crawling/01-VERIFICATION.md</files>
  <action>
Create verification document at `.planning/phases/01-web-crawling/01-VERIFICATION.md`:

```markdown
# Phase 1: Web Crawling - Verification Report

**Verified:** [DATE]
**Status:** [PASS/FAIL]

## Summary

| Category | Tests | Passed | Failed |
|----------|-------|--------|--------|
| Crawl Integration | X | X | 0 |
| API Integration | X | X | 0 |
| Edge Cases | X | X | 0 |
| Unit Tests | X | X | 0 |
| Frontend Components | X | X | 0 |
| **Total** | **X** | **X** | **0** |

## Requirement Verification Matrix

### Web Crawling Requirements

| Req ID | Requirement | Test File | Test Name | Status |
|--------|-------------|-----------|-----------|--------|
| CRL-01 | Sitemap.xml parsing | test_crawl_integration.py | test_full_crawl_discovers_pages_from_sitemap | PASS |
| CRL-02 | JS rendering via Playwright | test_browser_manager.py | test_fetch_page_success | PASS |
| CRL-03 | robots.txt compliance | test_crawl_integration.py | test_crawl_respects_robots_disallow | PASS |
| CRL-04 | Rate limiting (1/sec, 3 concurrent) | test_crawl_edge_cases.py | TestRateLimiterEdgeCases | PASS |
| CRL-05 | High-value page prioritization | test_crawl_integration.py | test_crawl_prioritizes_high_value_pages | PASS |
| CRL-06 | Max pages/depth config | test_crawl_integration.py | test_crawl_respects_max_pages_limit, test_crawl_respects_max_depth_limit | PASS |
| CRL-07 | External social link extraction | test_crawl_integration.py | test_crawl_extracts_external_social_links | PASS |

### API Requirements

| Req ID | Requirement | Test File | Test Name | Status |
|--------|-------------|-----------|-----------|--------|
| API-01 | POST /companies creates job | test_api_crawl_integration.py | test_create_company_returns_correct_response_format | PASS |
| API-03 | GET /companies lists with pagination | test_api_crawl_integration.py | test_list_companies_returns_pagination_meta | PASS |
| API-04 | GET /companies/:id with analysis | test_api_crawl_integration.py | test_get_company_includes_latest_analysis | PASS |

### UI Requirements

| Req ID | Requirement | Test File | Test Name | Status |
|--------|-------------|-----------|-----------|--------|
| UI-01 | Company submission form | AddCompany.test.tsx | Form validation tests | PASS |
| UI-02 | Company list with status badges | Dashboard.test.tsx | Company list tests | PASS |

## Test Evidence

### Crawl Integration Tests
[Output from test run]

### API Integration Tests
[Output from test run]

### Edge Case Tests
[Output from test run]

### Frontend Component Tests
[Output from test run]

## Gaps Identified

[List any failing tests or uncovered requirements]

## Recommendations

[Any recommendations for Phase 2 based on verification results]
```

Fill in actual test results from Task 1.
  </action>
  <verify>
Verification document exists and contains all requirement mappings.
  </verify>
  <done>Verification document created with complete requirement-to-test mapping.</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Complete Phase 1 test suite and verification documentation covering all requirements:
- CRL-01 to CRL-07 (Web Crawling)
- API-01, API-03, API-04 (API Endpoints)
- UI-01, UI-02 (UI Components)
  </what-built>
  <how-to-verify>
1. Review `.planning/phases/01-web-crawling/01-VERIFICATION.md`
2. Check that all requirements have associated tests
3. Check that all tests are passing (Status = PASS)
4. Optionally run: `python3 -m pytest backend/tests/ -v --tb=short | tail -50`
5. Optionally run: `cd frontend && npm test -- --run`
  </how-to-verify>
  <resume-signal>Type "verified" to confirm Phase 1 is complete, or describe any gaps found.</resume-signal>
</task>

</tasks>

<verification>
Phase 1 is verified when:
1. All test suites pass
2. Verification document maps all requirements to tests
3. Human has confirmed the verification report

```bash
# Quick verification
cd /Users/stephenhollifield/Cira && python3 -m pytest backend/tests/test_crawl_integration.py backend/tests/test_api_crawl_integration.py backend/tests/test_crawl_edge_cases.py -v --tb=line 2>&1 | tail -20
```
</verification>

<success_criteria>
- [ ] All Phase 1 tests pass
- [ ] Verification document created
- [ ] All 12 requirements (CRL-01-07, API-01/03/04, UI-01/02) mapped to tests
- [ ] Human verification checkpoint approved
</success_criteria>

<output>
After completion, create `.planning/phases/01-web-crawling/01-05-SUMMARY.md`
</output>
