# Export Formats Specification

## Overview

The export system generates company intelligence summaries in multiple formats for sharing and archival. All exports follow a consistent 2-page summary structure.

## Functional Requirements

### Summary Document (FR-OUT-001 to FR-OUT-003)

| ID | Requirement | Priority |
|----|-------------|----------|
| FR-OUT-001 | Generate 2-page markdown summary with defined structure | P0 |
| FR-OUT-002 | Include metadata: analysis date, website, industry, mode, tokens used | P0 |
| FR-OUT-003 | Include source page count and links to key pages | P0 |

### Export Formats (FR-EXP-001 to FR-EXP-004)

| ID | Requirement | Priority |
|----|-------------|----------|
| FR-EXP-001 | Export to Markdown (UTF-8) | P0 |
| FR-EXP-002 | Export to Word (.docx) with formatting | P1 |
| FR-EXP-003 | Export to PDF with formatting | P1 |
| FR-EXP-004 | Export to JSON with all structured data | P1 |

## Document Structure

### 2-Page Summary Template

```markdown
# {Company Name} - Intelligence Brief

**Analysis Date:** {date}
**Website:** {url}
**Industry:** {industry}
**Analysis Mode:** {quick|thorough}
**Pages Analyzed:** {count}
**Tokens Used:** {count} (Est. Cost: ${cost})

---

## Executive Summary

{3-4 paragraphs summarizing the company}

---

## Company Overview

- **Founded:** {year}
- **Headquarters:** {location}
- **Company Size:** {size if known}
- **Industry:** {classification}

{1-2 paragraph description}

---

## Business Model & Products

**Business Model:** {type}

### Key Products/Services
- {product 1}
- {product 2}
- ...

{Additional context}

---

## Team & Leadership

### Key Executives
| Name | Role |
|------|------|
| {name} | {role} |
| ... | ... |

{Team notes}

---

## Market Position

**Target Market:** {description}

**Key Differentiators:**
- {differentiator 1}
- {differentiator 2}

---

## Key Insights

- {insight 1}
- {insight 2}
- {insight 3}

---

## Red Flags & Concerns

{If any identified, otherwise "No significant concerns identified."}

---

## Sources

Key pages analyzed:
- {url 1}
- {url 2}
- ...

---

*Generated by CIRA v{version}*
```

## Format Specifications

### Markdown (UTF-8)

- File extension: `.md`
- Encoding: UTF-8
- Line endings: LF
- Tables: GitHub Flavored Markdown
- Links: Standard markdown format

### Word (.docx)

- Generated using python-docx
- Styles:
  - Title: Company Name
  - Heading 1: Section headers
  - Heading 2: Subsection headers
  - Normal: Body text
  - Table: Executive table style
- Page setup:
  - Letter size (8.5" x 11")
  - 1" margins
  - Single spacing
- Header: "Intelligence Brief - {Company Name}"
- Footer: "Generated by CIRA | Page {n}"

### PDF

- Generated using ReportLab
- Font: Helvetica family
- Font sizes:
  - Title: 18pt bold
  - H1: 14pt bold
  - H2: 12pt bold
  - Body: 10pt
- Page setup:
  - Letter size
  - 0.75" margins
- Header/Footer: Same as Word
- Hyperlinks: Clickable URLs

### JSON

- Includes all structured data
- Schema:

```json
{
  "company": {
    "id": "string",
    "name": "string",
    "websiteUrl": "string",
    "industry": "string"
  },
  "analysis": {
    "versionNumber": "number",
    "createdAt": "string (ISO 8601)",
    "executiveSummary": "string",
    "sections": {
      "companyOverview": { "content": "string", "sources": ["string"], "confidence": "number" },
      "businessModel": { ... },
      "teamLeadership": { ... },
      "marketPosition": { ... },
      "technology": { ... },
      "keyInsights": { ... },
      "redFlags": { ... }
    }
  },
  "entities": [
    {
      "type": "string",
      "value": "string",
      "context": "string",
      "sourceUrl": "string",
      "confidence": "number"
    }
  ],
  "pages": [
    {
      "url": "string",
      "pageType": "string",
      "crawledAt": "string"
    }
  ],
  "tokenUsage": {
    "total": "number",
    "input": "number",
    "output": "number",
    "estimatedCost": "number"
  },
  "metadata": {
    "generatedAt": "string",
    "ciraVersion": "string",
    "analysisMode": "string"
  }
}
```

## Acceptance Criteria

### Markdown Export
- Valid UTF-8 encoding
- Renders correctly in standard markdown viewers
- Tables display properly
- Links clickable when rendered

### Word Export
- Opens without errors in Microsoft Word
- Opens without errors in Google Docs
- Styles applied correctly
- Tables formatted properly
- Page breaks at appropriate locations

### PDF Export
- Opens without errors in standard PDF readers
- Text selectable and searchable
- Hyperlinks functional
- Fonts embedded
- Fits within 2 pages for typical analysis

### JSON Export
- Valid JSON syntax
- Schema validated
- All fields populated
- Dates in ISO 8601 format
- UTF-8 encoded

### Performance
- Export generation < 5 seconds (NFR-PER-005)
- Large analyses (100+ pages) still complete within limit

## Test Requirements

### Programmatic Tests

1. **Markdown Tests**
   - Output is valid UTF-8
   - All sections present
   - Links formatted correctly
   - Tables valid GFM

2. **Word Tests**
   - python-docx opens generated file
   - All styles applied
   - Content matches template structure

3. **PDF Tests**
   - ReportLab generates without error
   - PyPDF2 can read generated file
   - Page count <= 3 for typical analysis

4. **JSON Tests**
   - json.loads() succeeds
   - Schema validation passes
   - All required fields present
   - Dates valid ISO 8601

### Visual Tests (Human Review)

1. **Layout Review**
   - Word document looks professional
   - PDF renders attractively
   - Consistent formatting throughout

2. **Content Accuracy**
   - Data matches source analysis
   - No truncation or data loss
   - Special characters handled correctly

## Configuration

```typescript
interface ExportOptions {
  format: ExportFormat;
  includeRawData: boolean;  // Include entities/pages in export
  includeSources: boolean;  // Include source URLs
}

enum ExportFormat {
  MARKDOWN = 'markdown',
  WORD = 'word',
  PDF = 'pdf',
  JSON = 'json'
}
```

## File Retention

- Generated files stored for 7 days
- Auto-cleanup job removes older files
- User downloads not tracked

## Dependencies

- python-docx 1.1+ for Word generation
- ReportLab 4.0+ for PDF generation
- Standard library json for JSON
